function calculateDistance(e,t,n,r){var i,s,o,u,a,f,t,r,l,c;i=6371;a=(n-e)*Math.PI/180;f=(r-t)*Math.PI/180;e=e*Math.PI/180;n=n*Math.PI/180;c=Math.sin(f/2);l=Math.sin(a/2);s=l*l+c*c*Math.cos(e)*Math.cos(n);o=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return u=i*o}var gac=angular.module("getacar",["ngRoute"]);gac.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"home.html",controller:"HomeController"}).when("/cars/:lat/:lon",{templateUrl:"cars.html",controller:"CarsController"}).when("/map/:carId",{templateUrl:"map.html",controller:"MapController"}).otherwise({redirectTo:"/"})}]);gac.factory("DataSharingObject",function(){return{}});gac.factory("carsFactory",function(e,t){return{query:function(n,r){var i="/cars";n!=undefined&&r!=undefined&&(i="/cars/"+n+"/"+r);var s=t.defer();e.get(i).success(function(e,t,n,r){s.resolve(e)}).error(function(e,t,n,r){s.reject(t)});return s.promise},geoCode:function(n){var r=t.defer();e.get("/geocode",{params:{q:n}}).success(function(e,t,n,i){r.resolve(e)}).error(function(e,t,n,i){r.reject(t)});return r.promise}}});gac.controller("HomeController",function(e,t,n,r){e.geoCode=function(){r.geoCode(e.addrToGeocode).then(function(e){console.log("home",e);if(!e.Success)return;t.path("/cars/"+e.Lat+"/"+e.Lng)})}});gac.controller("MapController",function(e,t,n,r,i){e.car=i.cars[n.carId];e.all_cars=i.cars;mapObj.init(e.all_cars,n.carId)});gac.controller("CarsController",function(e,t,n,r,i){e.queryByClosest=function(){e.lat=n.lat;e.lon=n.lon;r.query(e.lat,e.lon).then(function(t){e.cars=t;i.cars=t})}();e.getDistance=function(t,n){return(calculateDistance(e.lat,e.lon,t,n)*1e3).toPrecision(4).toString()+" mt."}});mapObj={markers:[],reference:null,init:function(e,t){var n={zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(e[t].lat,e[t].lon)};mapObj.reference=new google.maps.Map(document.getElementById("map-canvas"),n);var r=new google.maps.TrafficLayer;r.setMap(mapObj.reference);mapObj.addCarMarkers(e,t)},addCarMarkers:function(e,t){for(var n=0,r=e.length;n<r;n++){var i=null,s="/images/ico_other_car.png";n==t&&(s="/images/ico_my_car.png");i=new google.maps.Marker({position:new google.maps.LatLng(e[n].lat,e[n].lon),icon:s,map:mapObj.reference});mapObj.markers.push(i)}}};